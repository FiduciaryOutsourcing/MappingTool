<script>
    function formatDate(date) {
        var d = new Date(date),
            month = '' + (d.getMonth() + 1),
            day = '' + d.getDate(),
            year = d.getFullYear();

        if (month.length < 2) month = '0' + month;
        if (day.length < 2) day = '0' + day;

        return [year, month, day].join('-');
    }

    var empIdNum = '[sample.employer_id]';
    var ascLocation = '[sample.ascLocation]';
    console.log(`ascLocation: ${ascLocation}`);
    var tempEmpName = "[sample.employer_name]"
    var empName = tempEmpName.replace(/[^a-zA-Z0-9 .,]/g, '');
    var empAddress1 = '[sample.employer_mailing_address_1]';
    var empAddress2 = '[sample.employer_mailing_address_2]';
    var empCity = '[sample.employer_city]';
    var empState = '[sample.employer_state]';
    var empZip = '[sample.employer_zip]';
    var empLocation = '[sample.Custom]';
    var contractNum = '[sample.ContractNumber]';
    var trimTop = '[sample.TrimTop]';
    var trimBottom = '[sample.TrimBottom]';
    var filter1Field = '[sample.Filter1Field]';
    var filter1Value = '[sample.Filter1Value]';
    var filter2Field = '[sample.Filter1Field]';
    var filter2Value = '[sample.Filter1Value]';
    var filter3Field = '[sample.Filter1Field]';
    var filter3Value = '[sample.Filter1Value]';
    var isMultiDivision = '[sample.IsMultiDivision]';
    var removeDuplicates = '[sample.RemoveDuplicates]';
    var customHeader = '[sample.CustomHeader]';
    var removeOldTerms = '[sample.RemoveOldTerms]';
    var eligDateInd = '[sample.needEligDate]';
    var headerRow = '[sample.headerRow]';

    var batchNum = '[samplesegment.447,params.employerId=[sample.employer_id]]';
    var recordKeeper = `[samplesegment.357,params.employer_id=[sample.employer_id],params.type=2]`;
    if (batchNum == '') {
        batchNum = 0;
    }
    var currDate = Date();
    var dateToday = formatDate(currDate);
    var timeNow = (new Date).toTimeString().slice(0, 8);
    // var ascLocation = '[samplesegment.376,PARAMS.employer_ID=[Sample.employer_ID],PARAMS.PayrollProviderLocation=]'
    var dateTimeStamp = dateToday + ' ' + timeNow;

    console.log('====== Debug for embedded code on page 202 ======');
    console.log('employer ID: ' + empIdNum);
    console.log('employer name: ' + empName);
    console.log(`empAddress1: ${empAddress1}`);
    console.log(`empAddress2: ${empAddress2}`);
    console.log(`empCity: ${empCity}`);
    console.log(`empState: ${empState}`);
    console.log(`empZip: ${empZip}`);
    console.log('batch number: ' + batchNum);
    console.log('contract number: ' + contractNum);
    console.log('current date: ' + dateToday);
    console.log('current time: ' + timeNow);
    console.log('date and time stamp: ' + dateTimeStamp);
    console.log('location value: ' + empLocation); // value from sample when it exists, i.e. Quorum locations
    console.log('trim top: ' + trimTop);
    console.log('trim borrom: ' + trimBottom);
    console.log('filter field 1: ' + filter1Field);
    console.log('filter value 1: ' + filter1Value);
    console.log('filter field 2: ' + filter2Field);
    console.log('filter value 2: ' + filter2Value);
    console.log('filter field 3: ' + filter3Field);
    console.log('filter value 3: ' + filter3Value);
    console.log('multi division: ' + isMultiDivision);
    console.log('remove duplicates: ' + removeDuplicates);
    console.log('custom header: ' + customHeader);
    console.log('remove old terms: ' + removeOldTerms);
    console.log(`Record Keeper: ${recordKeeper}`)
    console.log(`AscLocation: ${ascLocation}`)
    console.log(`eligDateInd : ${eligDateInd}`)
    localStorage.clear();
    console.log(`localStorage cleared`);
    // Setting local storage values for iframe retrieval
    localStorage.setItem('empIdNum', empIdNum);
    localStorage.setItem('empName', empName);
    localStorage.setItem('empAddress1', empAddress1);
    localStorage.setItem('empAddress2', empAddress2);
    localStorage.setItem('empCity', empCity);
    localStorage.setItem('empState', empState);
    localStorage.setItem('empZip', empZip);
    localStorage.setItem('batchNum', batchNum);
    localStorage.setItem('contractNum', contractNum); // may not always have a value
    localStorage.setItem('currDate', dateToday);
    localStorage.setItem('currTime', timeNow);
    localStorage.setItem('dateTimeStamp', dateTimeStamp);
    localStorage.setItem('empLocation', empLocation);
    localStorage.setItem('trimTop', trimTop);
    localStorage.setItem('trimBottom', trimBottom);
    localStorage.setItem('ff1', filter1Field);
    localStorage.setItem('fv1', filter1Value);
    localStorage.setItem('ff2', filter2Field);
    localStorage.setItem('fv2', filter2Value);
    localStorage.setItem('ff3', filter3Field);
    localStorage.setItem('fv3', filter3Value);
    localStorage.setItem('isMultiDivision', isMultiDivision);
    localStorage.setItem('removeDuplicates', removeDuplicates);
    localStorage.setItem('customHeader', customHeader);
    localStorage.setItem('removeOldTerms', removeOldTerms);
    localStorage.setItem('ascLocation', ascLocation)
    localStorage.setItem('recordKeeper', recordKeeper);
    localStorage.setItem('eligDateInd', eligDateInd);
    localStorage.setItem('headerRow', headerRow);
    // localStorage.setItem('loanIds', loanIds);
    console.log('localStorage values set');
</script>
<p><iframe id="uploadFrame" scrolling="no"
        src="https://operations.316fiduciaries.net/oesp/data/6sm5gu5fXD9qfZoyxO6la2Q1il2hHcp6zfY24jgUfggMW2CMSi93SwM7B4F7OSwm/34086077.html"
        style="border:none; overflow:hidden; background-color: white; margin-top:-80px; margin-left:-25px; height:800px; width:102%;"></iframe>
</p>

<p style="margin-left:-20px;font-size:13pt;">Step 3 <a class="btn btn-primary" id="uploadButton"
        style="width:275px;height:35px;">Upload Mapped Payroll Report</a></p>

<script>
    var thisBatchNum = parseInt(batchNum) + 1;
    var urlString =
        `/oesp/beginPanel.jsp?restart=true&surveyId=1048&genId=true&interviewerId=63&VARIABLEINTERVIEWERUSERNAME=chris.nellis@316fiduciaries.com&VARIABLEINTERVIEWERFIRSTNAME=Chris&VARIABLEINTERVIEWERLASTNAME=Nellis&employerId=${parseInt(empIdNum)}&batchNum=${thisBatchNum}&ascLocation=${ascLocation}`

    var urlEncoded = encodeURI(urlString);
    console.log(urlEncoded);
    var finalString = "sidePanel('" + decodeURI(urlEncoded) + "')";
    console.log(finalString);
    element = document.getElementById("uploadButton");
    element.setAttribute("onclick", finalString);
    localStorage.setItem('uploadUrlString', finalString);
</script>

<script>
    $(".table-responsive").css("display", "none");
    $(".panel").css("border-color", "white");
    $(".panel-heading").css("border-color", "white");
    $(".panel-heading").css("background-color", "white");

    function hideTables() {
        console.log('I got into this script tag');
        $(".table-responsive").css("display", "none");
        $(".panel").css("border-color", "white");
        $(".panel-heading").css("border-color", "white");
        $(".panel-heading").css("background-color", "white");
    }
    setTimeout(hideTables, 1500);
</script>